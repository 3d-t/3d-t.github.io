"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3530],{27025(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"installation/ingress","title":"External access via SSL","description":"Configure external HTTPS access to SpaceTime using Kubernetes Ingress, Let\'s Encrypt SSL certificates, and wildcard DNS.","source":"@site/docs/installation/ingress.md","sourceDirName":"installation","slug":"/installation/ingress","permalink":"/docs/installation/ingress","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"description":"Configure external HTTPS access to SpaceTime using Kubernetes Ingress, Let\'s Encrypt SSL certificates, and wildcard DNS.","keywords":["ingress","SSL","TLS","HTTPS","Let\'s Encrypt","certbot","Kubernetes Ingress","wildcard certificate","external access","security"]},"sidebar":"defaultSidebar","previous":{"title":"Releases","permalink":"/docs/installation/releases"},"next":{"title":"MQTT","permalink":"/docs/installation/mqtt"}}');var s=t(74848),c=t(28453);const a={sidebar_position:5,description:"Configure external HTTPS access to SpaceTime using Kubernetes Ingress, Let's Encrypt SSL certificates, and wildcard DNS.",keywords:["ingress","SSL","TLS","HTTPS","Let's Encrypt","certbot","Kubernetes Ingress","wildcard certificate","external access","security"]},i="External access via SSL",o={},d=[{value:"Create certificates",id:"create-certificates",level:2},{value:"Deploy ingress",id:"deploy-ingress",level:2},{value:"Update router",id:"update-router",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"external-access-via-ssl",children:"External access via SSL"})}),"\n",(0,s.jsx)(n.p,{children:"Most web browsers and devices require a secure connection over https. You can setup secure access to your Kubernetes cluster using an Kubernetes Ingress. Alternatively you can use Nginx or Apache."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"If you do not need to provide external access you may skip this section."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"create-certificates",children:"Create certificates"}),"\n",(0,s.jsxs)(n.p,{children:["To run a secure server you need a certificate. This certificate validates that your service can be trusted and shows up in the web browser when a user clicks on the lock icon.  You can obtain free SSL certificates from ",(0,s.jsx)(n.a,{href:"https://letsencrypt.org/",children:"LetEncrypt"}),". These certificates are valid for 3 months and can be renewed. An easy way to create the certificates is via openssl and certbot."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo apt install openssl\nsudo apt install certbot\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You need a so called wildcard certificate so you can expose multiple services that are deployed in the kubernetes cluster, such as ",(0,s.jsx)(n.code,{children:"app.my_domain.com"})," or ",(0,s.jsx)(n.code,{children:"mqtt.my_domain.com"}),". You should replace ",(0,s.jsx)(n.code,{children:"my_domain.com"})," with the actual domain name that you want to use.\nTo create the wildcard certificate:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo certbot certonly --manual --agree-tos -d '*.my_domain.com'\n"})}),"\n",(0,s.jsx)(n.p,{children:"Answer the questions and wait for the instructions to deploy a text record. When you apply for a wildcard certificate you have to prove that you are the operator of the domain by placing a TXT record."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Please deploy a DNS TXT record under the name\n_acme-challenge.my_domain.com with the following value:\n\nKkfd0s9shC9-eKpYVb601cO1_1OwVEyFsliHRUMSdchI\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can now configure your domain registration to include a new ",(0,s.jsx)(n.code,{children:"TXT"})," record with name ",(0,s.jsx)(n.code,{children:"_acme-challenge.my_domain.com"})," and value ",(0,s.jsx)(n.code,{children:"Kkfd0s9shC9-eKpYVb601cO1_1OwVEyFsliHRUMSdchI"}),". Before continuing make sure that your domain is updates. This can take several minutes."]}),"\n",(0,s.jsxs)(n.p,{children:["You can verify the deployment by entering the domain ",(0,s.jsx)(n.code,{children:"_acme-challenge.my_domain.com"})," in the box on web site ",(0,s.jsx)(n.code,{children:"http://dnslookup.online/txt.html"}),". If the domain is updated you can continue the certbot certification process. The certificates are installed in the directory ",(0,s.jsx)(n.code,{children:"/etc/letsencrypt/live/my_domain.com"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"deploy-ingress",children:"Deploy ingress"}),"\n",(0,s.jsxs)(n.p,{children:["The certificate and private key generated by certbot are used to create a Kubernetes Secret called ",(0,s.jsx)(n.code,{children:"wildcard-tls"}),". This secret is then used in the configuration of the ingress."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'sudo cp /etc/letsencrypt/live/my_domain.com/fullchain.pem tls.crt\nsudo cp /etc/letsencrypt/live/my_domain.com/privkey.pem tls.key\nsudo kubectl create secret tls spacetime-tls --key="tls.key" --cert="tls.crt"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["To configure the Ingress create a file 'ingress.yml' with the following content and replace the name ",(0,s.jsx)(n.code,{children:"my_domain.com"})," with your actual domain. Make sure that the name of the secret matches the name of the secret that you just created. Make sure that the ports of the different services match their externally exposed ports."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: spacetime-tls\nspec:\n  tls:\n  - hosts:\n      - modeler.my_domain.com\n      - portal.my_domain.com\n      - forms.my_domain.com\n      - server.my_domain.com\n    secretName: solidengineer\n  rules:\n  - host: portal.my_domain.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: portal\n            port:\n              number: 3000\n  - host: forms.my_domain.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: forms\n            port:\n              number: 3002\n  - host: modeler.my_domain.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: modeler\n            port:\n              number: 3005\n  - host: server.my_domain.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: server\n            port:\n              number: 8010\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can now install the ingress:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl create -f ingress.yml\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you make changes to the configuration you can apply the changes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl apply -f ingress.yml\n"})}),"\n",(0,s.jsx)(n.h2,{id:"update-router",children:"Update router"}),"\n",(0,s.jsxs)(n.p,{children:["On your router add a rule that forwards traffic on port ",(0,s.jsx)(n.code,{children:"443"})," to the IP address of the server where the Kubernetes cluster is deployed. Setting up the forwarding rule is different for each router.  You should now be able to access the service from anywhere on the Internet by opening a web browser or using curl:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"curl -v https://portal.my_domain.com\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453(e,n,t){t.d(n,{R:()=>a,x:()=>i});var r=t(96540);const s={},c=r.createContext(s);function a(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);