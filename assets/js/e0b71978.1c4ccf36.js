"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3222],{15680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>u});var a=n(96540);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},d="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),m=i,u=d["".concat(c,".").concat(m)]||d[m]||g[m]||r;return n?a.createElement(u,o(o({ref:t},p),{},{components:n})):a.createElement(u,o({ref:t},p))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[d]="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},34648:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=n(58168),i=(n(96540),n(15680));const r={sidebar_position:300},o="Control",s={unversionedId:"drawings/diagrams",id:"drawings/diagrams",title:"Control",description:"Drawings can be used to display IoT values stored in topics and values can also be modified by clicking on elements in the drawing. In this example we show how this can be used to display the current state of an irrigation system and how the user can control it by clicking on valves and pump in the drawing.",source:"@site/docs/drawings/diagrams.md",sourceDirName:"drawings",slug:"/drawings/diagrams",permalink:"/docs/drawings/diagrams",draft:!1,tags:[],version:"current",sidebarPosition:300,frontMatter:{sidebar_position:300},sidebar:"defaultSidebar",previous:{title:"Monitoring",permalink:"/docs/drawings/monitoring"},next:{title:"Visualization",permalink:"/docs/drawings/visualization"}},c={},l=[{value:"MQTT",id:"mqtt",level:2},{value:"Connector",id:"connector",level:2},{value:"Topics",id:"topics",level:2},{value:"Diagram",id:"diagram",level:2},{value:"MQTT",id:"mqtt-1",level:2}],p={toc:l},d="wrapper";function g(e){let{components:t,...r}=e;return(0,i.yg)(d,(0,a.A)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"control"},"Control"),(0,i.yg)("p",null,"Drawings can be used to display IoT values stored in topics and values can also be modified by clicking on elements in the drawing. In this example we show how this can be used to display the current state of an irrigation system and how the user can control it by clicking on valves and pump in the drawing."),(0,i.yg)("h2",{id:"mqtt"},"MQTT"),(0,i.yg)("p",null,"We use the free and open source MQTT client 'mosquitto_pub' to send a message with the state information. The host is the free MQTT host ",(0,i.yg)("inlineCode",{parentName:"p"},"broker.hivemq.com")," and the topic is ",(0,i.yg)("inlineCode",{parentName:"p"},"spacetime/irrigation")," followed by the ID of the irrigation system. The message is a JavaScript object with fields and values for the pump and valves."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},'mosquitto_pub -h broker.hivemq.com -t spacetime/irrigation/front -m "{pump:1, valve1:0, valve2:0, valve3:0}"\nmosquitto_pub -h broker.hivemq.com -t spacetime/irrigation/back -m "{pump:0, valve1:1, valve2:0, valve3:0}"\n')),(0,i.yg)("h2",{id:"connector"},"Connector"),(0,i.yg)("p",null,"To receive the messages we first define a secret to store the information for the MQTT host. The ",(0,i.yg)("inlineCode",{parentName:"p"},"type")," is set to ",(0,i.yg)("inlineCode",{parentName:"p"},"MQTT")," and a free public domain host ",(0,i.yg)("inlineCode",{parentName:"p"},"broker.hivemq.com")," is entered. This host does not need authentication. Then we specify the topic to which we want to subscribe. The ",(0,i.yg)("inlineCode",{parentName:"p"},"#")," sign means that we want to subscribe to all subtopics."),(0,i.yg)("p",null,(0,i.yg)("img",{src:n(13723).A,width:"2400",height:"600"})),(0,i.yg)("p",null,"Create a new connector and add two object mappings. For each topic define the corresponding mapping to the MQTT topic and then click on ",(0,i.yg)("inlineCode",{parentName:"p"},"test"),". In the data field you can see how the information from the MQTT host is mapped to a JSON object. The topic is stored in the ",(0,i.yg)("inlineCode",{parentName:"p"},"object")," field and the message is stored in the ",(0,i.yg)("inlineCode",{parentName:"p"},"data")," field."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "object": "spacetime/irrigation/front",\n    "data": {\n      "pump": 1,\n      "valve1": 0,\n      "valve2": 0,\n      "valve3": 0.\n    },\n    "time": "2026-01-05T14:11:03.641Z"\n  },\n  {\n    "object": "spacetime/irrigation/back",\n    "data": {\n      "pump": 0,\n      "valve1": 1,\n      "valve2": 0,\n      "valve3": 0.\n    },\n    "time": "2026-01-05T14:11:09.149Z"\n  }\n]\n')),(0,i.yg)("p",null,(0,i.yg)("img",{src:n(16335).A,width:"2400",height:"1300"})),(0,i.yg)("h2",{id:"topics"},"Topics"),(0,i.yg)("p",null,"The example below shows how to link IoT values stored in topics to the drawing. The topics are connected to the drawing with the ",(0,i.yg)("inlineCode",{parentName:"p"},"geometry")," attribute. This includes the name of the drawing and a single parameter, in this case the name of the topic 'irrigation_0'. "),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"irrigation.front.geometry = Irrigation(irrigation.front)\nirrigation.front.pump = 1\nirrigation.front.valve1 = 0\nirrigation.front.valve2 = 0\nirrigation.front.valve3 = 0\nirrigation.front.scale = 0.5, 0.5\n")),(0,i.yg)("p",null,"When a name of a topic is specified, the parameter is converted to a JSON object that contains the fields and values of the sub topics. So in this case the ",(0,i.yg)("inlineCode",{parentName:"p"},"irrigation.front")," topic is converted to the following object:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},'let irrigation.front = {\n    "pump": 1,\n    "valve1": 0,\n    "valve2": 0,\n    "valve3": 0,\n    "scale": 0.5, 0.5\n}\n')),(0,i.yg)("p",null,"A second drawing with different values is shown below. The settings for the pumps and valves are different. The drawing is positioned 400 pixels to the right of the first drawing."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"irrigation.back.geometry = Irrigation(irrigation.back)\nirrigation.back.pump = 0\nirrigation.back.valve1 = 1\nirrigation.back.valve2 = 0\nirrigation.back.valve3 = 0\nirrigation.back.scale = 0.5, 0.5\nirrigation.back.translation = 400,0\n")),(0,i.yg)("h2",{id:"diagram"},"Diagram"),(0,i.yg)("p",null,"From the navigation menu select the option ",(0,i.yg)("inlineCode",{parentName:"p"},"Diagrams"),". Then click the button ",(0,i.yg)("inlineCode",{parentName:"p"},"Add")," to create a new diagram. In the diagram click on the ",(0,i.yg)("inlineCode",{parentName:"p"},"+")," button to add topics to display in the diagram. When you click on the pumps or valves in the diagram, the values of the related topics are updated. The diagram functions as a custom user interface component such as a date picker of slider."),(0,i.yg)("p",null,(0,i.yg)("img",{src:n(55533).A,width:"2400",height:"900"})),(0,i.yg)("h2",{id:"mqtt-1"},"MQTT"),(0,i.yg)("p",null,"You can now check that MQTT messages are sent by starting an MQTT subscriber client in a terminal. After you click on a pump or a valve in the drawing, the new state is sent to the MQTT server. This can be used to control a physical pump or valve."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"mosquitto_sub -h broker.hivemq.com -v -t spacetime/irrigation/#\nspacetime/irrigation/back {valve2: 1}\nspacetime/irrigation/back {valve3: 0}\nspacetime/irrigation/front {pump: 1}\nspacetime/irrigation/front {valve1: 1}\n")))}g.isMDXComponent=!0},16335:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/irrigation-ba4e8fe1d368b230d10a3fc1d6481cb3.png"},55533:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/irrigation-43aa321fc2624d284d3c4eefc1b5ddcf.png"},13723:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/mqtt_irrigation-d8a6b3f993d23b5a8b818de4bc8f0095.png"}}]);