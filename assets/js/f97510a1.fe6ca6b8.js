"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4129],{22926(e,t,s){s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"integrations/homeassistant","title":"Home Assistant","description":"Bi-directional integration with Home Assistant for reading sensor data and controlling devices such as thermostats via the Home Assistant REST API.","source":"@site/docs/integrations/homeassistant.md","sourceDirName":"integrations","slug":"/integrations/homeassistant","permalink":"/docs/integrations/homeassistant","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":25,"frontMatter":{"sidebar_position":25,"description":"Bi-directional integration with Home Assistant for reading sensor data and controlling devices such as thermostats via the Home Assistant REST API.","keywords":["Home Assistant","home automation","REST API","thermostat","HVAC","smart home","temperature control"]},"sidebar":"defaultSidebar","previous":{"title":"Tesla","permalink":"/docs/integrations/tesla"},"next":{"title":"Nefit","permalink":"/docs/integrations/nefit"}}');var i=s(74848),r=s(28453);const a={sidebar_position:25,description:"Bi-directional integration with Home Assistant for reading sensor data and controlling devices such as thermostats via the Home Assistant REST API.",keywords:["Home Assistant","home automation","REST API","thermostat","HVAC","smart home","temperature control"]},o="Home Assistant",c={},d=[{value:"Web service",id:"web-service",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Secret",id:"secret",level:2},{value:"Script",id:"script",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"home-assistant",children:"Home Assistant"})}),"\n",(0,i.jsxs)(t.p,{children:["Home Assistant is an open source platform for home automation. It provides integrations with many devices and supports a ",(0,i.jsx)(t.a,{href:"https://developers.home-assistant.io/docs/api/rest/",children:"Home Assistent Rest API"})," for reading and setting parameters."]}),"\n",(0,i.jsx)(t.h2,{id:"web-service",children:"Web service"}),"\n",(0,i.jsx)(t.p,{children:"If you do not have a running instance of Home Assistant you can deploy one on your cluster."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"helm install homeassistant spacetime/homeassistant\n"})}),"\n",(0,i.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(t.p,{children:["Open a web browser to ",(0,i.jsx)(t.code,{children:"http://[IP_ADDRESS]:8123"})," where the IP_ADDRESS is the the address of the server where kubernetes is installed. Follow the onboarding procedure. Go to the user profile and create a long lived access token."]}),"\n",(0,i.jsx)(t.h2,{id:"secret",children:"Secret"}),"\n",(0,i.jsx)(t.p,{children:"Create a secret with name 'Homeassistant' and the following fields:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"field"}),(0,i.jsx)(t.th,{children:"value"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"type"}),(0,i.jsx)(t.td,{children:"script"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"token"}),(0,i.jsx)(t.td,{children:"[TOKEN]"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"script"}),(0,i.jsx)(t.td,{children:"Homeassistant"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"script",children:"Script"}),"\n",(0,i.jsxs)(t.p,{children:["Create a script with a ",(0,i.jsx)(t.code,{children:"get"})," and ",(0,i.jsx)(t.code,{children:"set"})," function that calls the Home Assistant REST API.\nThe Home Assistant API can be accessed via the name of the service in the cluster ",(0,i.jsx)(t.code,{children:"homeassistant"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"const get = async (object, context) => {\n  \tlet options = { \n      url: 'http://homeassistant:8123/api/states/' + object,\n      headers: {\n      'Authorization': 'Bearer ' + context.token\n       }\n    }\n    let response = await fetch(options.url, options);\n    let data = await response.json()\n  \treturn data\n}\n\nconst set = async (object, value, context) => {\n  \tlet options = { \n      url: 'http://homeassistant:8123/api/services/climate/set_temperature',\n      method: 'POST',\n      body: JSON.stringify({\"entity_id\" : object, \"temperature\": value, \"hvac_mode\": \"heat\"}),\n      headers: {\n      'Content-Type': 'application/json',\n      'Authorization': 'Bearer ' + context.token,\n       }\n    }\n    let response = await fetch(options.url,options);\n    let data = await response.json()\n  \treturn data\n}\n"})}),"\n",(0,i.jsx)(t.h1,{id:"connector",children:"Connector"}),"\n",(0,i.jsxs)(t.p,{children:["Create a connector with name ",(0,i.jsx)(t.code,{children:"Homeassistant"})," and data source ",(0,i.jsx)(t.code,{children:"Homeassistant"}),". To read temperature from an object in Homeassistant with entity_id ",(0,i.jsx)(t.code,{children:"climate.zone1"}),", add the following object mapping:"]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"topic"}),(0,i.jsx)(t.th,{children:"value"})]})}),(0,i.jsx)(t.tbody,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"home.hvac"}),(0,i.jsx)(t.td,{children:"climate.zone1"})]})})]}),"\n",(0,i.jsx)(t.p,{children:"To read the temperature setting and actual temperature add the following key mapping:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"key"}),(0,i.jsx)(t.th,{children:"value"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"thermostat"}),(0,i.jsx)(t.td,{children:"attributes.temperature"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"temperature"}),(0,i.jsx)(t.td,{children:"attributes.current_temperature"})]})]})]})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453(e,t,s){s.d(t,{R:()=>a,x:()=>o});var n=s(96540);const i={},r=n.createContext(i);function a(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);