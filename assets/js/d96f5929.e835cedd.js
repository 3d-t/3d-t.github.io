"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4443],{5680:(e,t,n)=>{n.d(t,{xA:()=>d,yg:()=>g});var r=n(6540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},l="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),l=p(n),u=a,g=l["".concat(c,".").concat(u)]||l[u]||h[u]||i;return n?r.createElement(g,o(o({ref:t},d),{},{components:n})):r.createElement(g,o({ref:t},d))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[l]="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1496:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(9668),a=(n(6540),n(5680));const i={sidebar_position:40},o="OpenWeather",s={unversionedId:"integrations/openweather",id:"integrations/openweather",title:"OpenWeather",description:"Weather information can be used for analysis and predication purposes or to control devices. OpenWeather is a free weather service which provides current weather and forecast for all locations. This integration used the standard importer in combination with a JavaScript class for retrieving and parsing the weather information. The weather information also includes the sunrise and sunset for the date and location. This can be used to control lights.",source:"@site/docs/integrations/openweather.md",sourceDirName:"integrations",slug:"/integrations/openweather",permalink:"/docs/integrations/openweather",draft:!1,tags:[],version:"current",sidebarPosition:40,frontMatter:{sidebar_position:40},sidebar:"defaultSidebar",previous:{title:"Nefit",permalink:"/docs/integrations/nefit"},next:{title:"Tuya",permalink:"/docs/integrations/tuya"}},c={},p=[{value:"Script",id:"script",level:2},{value:"Datasource",id:"datasource",level:2},{value:"Connector",id:"connector",level:2},{value:"Form",id:"form",level:2}],d={toc:p},l="wrapper";function h(e){let{components:t,...i}=e;return(0,a.yg)(l,(0,r.A)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"openweather"},"OpenWeather"),(0,a.yg)("p",null,"Weather information can be used for analysis and predication purposes or to control devices. OpenWeather is a free weather service which provides current weather and forecast for all locations. This integration used the standard importer in combination with a JavaScript class for retrieving and parsing the weather information. The weather information also includes the sunrise and sunset for the date and location. This can be used to control lights."),(0,a.yg)("p",null,(0,a.yg)("img",{src:n(3211).A,width:"2732",height:"1520"})),(0,a.yg)("h2",{id:"script"},"Script"),(0,a.yg)("p",null,"Create a new script with a ",(0,a.yg)("inlineCode",{parentName:"p"},"get")," function. The ",(0,a.yg)("inlineCode",{parentName:"p"},"get")," function loads the secret defined in the importer, which includes the ",(0,a.yg)("inlineCode",{parentName:"p"},"APPID"),".  The script makes an HTTP request to the OpenWeather API and then returns the results as an object. The parameter ",(0,a.yg)("inlineCode",{parentName:"p"},"object")," is the name of the location, such as ",(0,a.yg)("inlineCode",{parentName:"p"},"Paris")," or ",(0,a.yg)("inlineCode",{parentName:"p"},"Rome"),". Note that the object also contains a field ",(0,a.yg)("inlineCode",{parentName:"p"},"object")," with the value of the parameter object, in this case the geographical location for which the weather was requested."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-javascript"},"const get = async (object, context) => {\n    const url = 'https://api.openweathermap.org/data/2.5/weather?q=' + object + \"&APPID=\" + context.APPID;\n    let response = await http.get(url)\n    let data = response\n    let weather = {}\n    if (data) {\n        weather.temperature = Math.round(data.main.temp - 272.15)\n        weather.windchill = Math.round(data.main.feels_like - 272.15)\n        weather.pressure = data.main.pressure\n        weather.humidity = data.main.humidity\n        weather.wind = data.wind\n        weather.wind_speed = data.wind.speed\n        weather.wind_direction = data.wind.deg\n        weather.clouds = data.clouds.all\n        weather.sunrise = new Date(data.sys.sunrise * 1000)\n        weather.sunset = new Date(data.sys.sunset * 1000)\n        weather.visibility = data.visibility\n    }\n    return weather\n}\n")),(0,a.yg)("h2",{id:"datasource"},"Datasource"),(0,a.yg)("p",null,"OpenWeather is a free service but they require you to register and obtain a key.  Open a browser to ",(0,a.yg)("a",{parentName:"p",href:"https://openweathermap.org/api"},"https://openweathermap.org/api")," and subscibe to the free service and request an API key. Create a new secret with fields for ",(0,a.yg)("inlineCode",{parentName:"p"},"type"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"script")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"APPID"),".\nThis key needs to be included in every request to the API and is stored in a secret."),(0,a.yg)("p",null,(0,a.yg)("img",{src:n(38).A,width:"2732",height:"1122"})),(0,a.yg)("h2",{id:"connector"},"Connector"),(0,a.yg)("p",null,"Create a new connector and enter the name of the secret in the data source field. Optionally specify a schedule for running the importer. Click on ",(0,a.yg)("inlineCode",{parentName:"p"},"Object")," in the menu to create one or more objects that represent the locations for which you need the weather info. If no key mapping is defined all fields are automatically included with their original name. "),(0,a.yg)("p",null,(0,a.yg)("img",{src:n(3012).A,width:"2732",height:"1802"})),(0,a.yg)("h2",{id:"form"},"Form"),(0,a.yg)("p",null,"Create a new form with the following definition. Note that the wind control is displayed as a combination of wind speed and wind direction. The ",(0,a.yg)("inlineCode",{parentName:"p"},"sunrise")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"sunset")," values are imported as date objects and displayed as time using a JavaScript function ",(0,a.yg)("inlineCode",{parentName:"p"},"toLocaleTimeString"),"."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"Weather\n\nTemperature\n<temperature\n[-40|-5:purple,-5|5:blue,5|18:magenta,18|25:green,25|30:orange,30|40:red C]\n|4\n\nWind chill\n<windchill\n[-40|-5:purple,-5|5:blue,5|18:magenta,18|25:green,25|25:orange,30|40:red C]\n|4\n\nClouds\n<clouds\n[0|20:blue,20|40:yellow,40|80:green,80|100:grey %]\n|4\n\nPressure\n<pressure\n[0000 hPa]\n|4\n\nHumidity\n<humidity*20\n[00]\n|4\n\nVisibility\n<visibility\n[0000 m]\n|4\n\nWind\n<\"\" + Math.round(wind_speed*3.6) + '/' + wind_direction\n[000]\n|4\n\nSun rise\n<new Date(sunrise).toLocaleTimeString()\n|4\n\nSun set\n<new Date(sunset).toLocaleTimeString()\n|4\n")))}h.isMDXComponent=!0},3012:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/importer_openweather-6f0f3c3edc0b4ad0b03cdb64efa22246.png"},3211:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/item_weather-84da8e5e61626fbb210b2d8da8cb3133.png"},38:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/secret_openweather-02529af6041cf8d3c5fc1ce5e692a16b.png"}}]);