"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[553],{14906(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"integrations/zwave","title":"Zwave","description":"Bi-directional Z-Wave integration using the Zwave2Mqtt bridge for controlling power switches and reading multi-sensor data for temperature, luminance, and motion detection.","source":"@site/docs/integrations/zwave.md","sourceDirName":"integrations","slug":"/integrations/zwave","permalink":"/docs/integrations/zwave","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"sidebar_position":60,"description":"Bi-directional Z-Wave integration using the Zwave2Mqtt bridge for controlling power switches and reading multi-sensor data for temperature, luminance, and motion detection.","keywords":["Z-Wave","Zwave2Mqtt","MQTT","power switch","motion sensor","temperature","luminance","home automation","smart home"]},"sidebar":"defaultSidebar","previous":{"title":"MQTT","permalink":"/docs/integrations/mqtt"},"next":{"title":"Fritzbox","permalink":"/docs/integrations/fritzbox"}}');var o=t(74848),i=t(28453);const s={sidebar_position:60,description:"Bi-directional Z-Wave integration using the Zwave2Mqtt bridge for controlling power switches and reading multi-sensor data for temperature, luminance, and motion detection.",keywords:["Z-Wave","Zwave2Mqtt","MQTT","power switch","motion sensor","temperature","luminance","home automation","smart home"]},r="Zwave",c={},l=[{value:"Datasource",id:"datasource",level:2},{value:"Script",id:"script",level:2},{value:"Connector",id:"connector",level:2},{value:"Form",id:"form",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"zwave",children:"Zwave"})}),"\n",(0,o.jsxs)(n.p,{children:["This integration uses a script for subscribing and publishing to an MQTT server connected to the ",(0,o.jsx)(n.a,{href:"/docs/installation/zwave",children:"Zwave2Mqtt bridge"}),". The integration is bi-directional, which means you can read values but also set values, for example to turn on a switch. The example below shows the integration of two Zwave power switches and a ",(0,o.jsx)(n.a,{href:"https://www.zwavetaiwan.com.tw/pst02",children:"Philio Technology"})," multi-sensor for temperature, luminance and motion detection."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(4883).A+"",width:"2732",height:"1312"})}),"\n",(0,o.jsx)(n.h2,{id:"datasource",children:"Datasource"}),"\n",(0,o.jsxs)(n.p,{children:["Create a new secret but instead of setting the type to ",(0,o.jsx)(n.code,{children:"mqtt"})," we now set the type to ",(0,o.jsx)(n.code,{children:"script"})," and let the script handle the MQTT interaction."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(96289).A+"",width:"2732",height:"1122"})}),"\n",(0,o.jsx)(n.h2,{id:"script",children:"Script"}),"\n",(0,o.jsxs)(n.p,{children:["Instead of using a JavaScript ",(0,o.jsx)(n.code,{children:"mqtt.set()"})," and ",(0,o.jsx)(n.code,{children:"mqtt.get()"})," call we use a script that extracts the MQTT message and displays the data. The script also handles publishing MQTT topics to control devices by appending a ",(0,o.jsx)(n.code,{children:"/set"})," postfix to the topic and wrapping the value in a JSON object."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const get = async (object, context) => {\n    let event = await mqtt.get(object)\n    return event.message\n}\n\nconst set = async (object, key, value, context) => {\n    var topic = object + '/' + key + '/set';\n    var message = '{\"value\":' + value + '}';\n    mqtt.publish(topic, message, context)\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["To test the script enter the code below and select ",(0,o.jsx)(n.code,{children:"Run"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"let context = await encryption.secret(\"ZwaveSwitch\")\nlet event = await get('zwave/office', context)\nprint('State ' + JSON.stringify(event,null,2))\nawait set('zwave/office/lamp','on', false, context)\n"})}),"\n",(0,o.jsx)(n.p,{children:"When the test is run the output should look as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "pir": {\n    "temperature": {\n      "time": 1654609986703,\n      "value": 72\n    },\n    "illuminance": {\n      "time": 1654601135119,\n      "value": 36\n    },\n    "security": {\n      "time": 1654601135124,\n      "value": "Motion Detected at Unknown Location"\n    },\n  },\n  "printer": {\n    "voltage": {\n      "time": 1654610509073,\n      "value": 228.43\n    },\n    "ampere": {\n      "time": 1654610510075,\n      "value": 0\n    },\n    "kwh": {\n      "time": 1654610507086,\n      "value": 56.67\n    },\n    "on": {\n      "time": 1654609902578,\n      "value": true,\n      "set": {\n        "value": true\n      }\n    },\n  },\n  "lamp": {\n    "kwh": {\n      "time": 1654610714063,\n      "value": 96.55\n    },\n    "voltage": {\n      "time": 1654610715215,\n      "value": 234.42\n    },\n    "ampere": {\n      "time": 1654610716215,\n      "value": 0\n    },\n    "on": {\n      "time": 1654610709085,\n      "value": false,\n      "set": {\n        "value": false\n      }\n    },\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"connector",children:"Connector"}),"\n",(0,o.jsxs)(n.p,{children:["The importer shows how the main topic ",(0,o.jsx)(n.code,{children:"office.htc"})," is mapped to the MQTT topic ",(0,o.jsx)(n.code,{children:"zwave/office"}),". This means that all subtopics are includes, such as ",(0,o.jsx)(n.code,{children:"zwave/office/pir/temperature"})," and ",(0,o.jsx)(n.code,{children:"zwave/office/lamp/voltage"}),". The value of the field ",(0,o.jsx)(n.code,{children:"zwave/office/lamp/on"})," with value ",(0,o.jsx)(n.code,{children:"true"})," or ",(0,o.jsx)(n.code,{children:"false"})," is mapped to the topic ",(0,o.jsx)(n.code,{children:"office.htc.room.lamp.on"})," with value ",(0,o.jsx)(n.code,{children:"0"})," and ",(0,o.jsx)(n.code,{children:"1"}),". The MQTT also allows setting the value. The export is mapped to the topic ",(0,o.jsx)(n.code,{children:"zwave/office/lamp/on"}),". The ",(0,o.jsx)(n.code,{children:"set"})," function appends ",(0,o.jsx)(n.code,{children:"/set"})," to the topic so the MQTT topic becomes ",(0,o.jsx)(n.code,{children:"zwave/office/lamp/on/set"})," and the message becomes ",(0,o.jsx)(n.code,{children:"{value: true}"})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(19216).A+"",width:"2732",height:"1802"})}),"\n",(0,o.jsx)(n.h2,{id:"form",children:"Form"}),"\n",(0,o.jsxs)(n.p,{children:["To view the data and control the switches you can manually load the state for ",(0,o.jsx)(n.code,{children:"office.htc.room.lamp.on"})," and change the value from ",(0,o.jsx)(n.code,{children:"0"})," to ",(0,o.jsx)(n.code,{children:"1"}),", or this can be done automatically by an automation script. To control the switch manually you can create a new form."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Room panel\n\nlamp.on:Lamp\n[powerbutton]\n\nprinter.on:Printer\n[powerbutton]\n\nLamp\n<lamp.power\n[000 W]\n\nPrinter\n<printer.power\n[000 W]\n\nTemperature\n<Math.round((temperature-32)*5/9)\n[16|18:magenta,18|22:green,22|25:red C]\n\nLuminance\n<luminance\n[0|30:grey,30|80:green,90|100:red %]\n"})}),"\n",(0,o.jsxs)(n.p,{children:["After creating the form go to ",(0,o.jsx)(n.code,{children:"Items"})," and search for ",(0,o.jsx)(n.code,{children:"office.htc.room"}),". In this form you can view the data and press the switches."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},19216(e,n,t){t.d(n,{A:()=>a});const a=t.p+"assets/images/connector_zwave_office-546cc0e938c39ed0acbe2cdc4b4bdc67.png"},4883(e,n,t){t.d(n,{A:()=>a});const a=t.p+"assets/images/item_room-0334bee2c4fd12a593aa0ac66e895faf.png"},96289(e,n,t){t.d(n,{A:()=>a});const a=t.p+"assets/images/secret_zwave_switch-96254e51b933bb0ff0102d33a25ca127.png"},28453(e,n,t){t.d(n,{R:()=>s,x:()=>r});var a=t(96540);const o={},i=a.createContext(o);function s(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);