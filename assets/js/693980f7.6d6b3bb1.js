"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[6597],{78860(e,t,a){a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>c,default:()=>l,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"installation/backup","title":"Backup","description":"How to backup and restore the SpaceTime MongoDB database using mongodump, Kubernetes exec commands, and scheduled cron jobs.","source":"@site/docs/installation/backup.md","sourceDirName":"installation","slug":"/installation/backup","permalink":"/docs/installation/backup","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"description":"How to backup and restore the SpaceTime MongoDB database using mongodump, Kubernetes exec commands, and scheduled cron jobs.","keywords":["backup","restore","MongoDB","mongodump","mongorestore","Kubernetes","cron job","database backup","disaster recovery"]},"sidebar":"defaultSidebar","previous":{"title":"Zigbee","permalink":"/docs/installation/zigbee"},"next":{"title":"Trouble shooting","permalink":"/docs/installation/troubleshooting"}}');var n=a(74848),s=a(28453);const r={sidebar_position:20,description:"How to backup and restore the SpaceTime MongoDB database using mongodump, Kubernetes exec commands, and scheduled cron jobs.",keywords:["backup","restore","MongoDB","mongodump","mongorestore","Kubernetes","cron job","database backup","disaster recovery"]},c="Backup",i={},d=[{value:"Backup database",id:"backup-database",level:2},{value:"Restore database",id:"restore-database",level:2}];function u(e){const t={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"backup",children:"Backup"})}),"\n",(0,n.jsxs)(t.p,{children:["All user data and documents are stored in a mongo database. The other components only store log files and configuration. Mongo provides an easy way to backup the information using the ",(0,n.jsx)(t.code,{children:"mongodump"})," command. This also includes any documents and images. You can use a Kubernetes cron job to automatically dump the database at regular intervals. An alternative is to use a shell script and Linux cron job as described below."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"If you are just testing the installation or already have a procedure for mongo database backup you may skip this section."}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"backup-database",children:"Backup database"}),"\n",(0,n.jsxs)(t.p,{children:["Creating a backup can be done by executing a kubernetes ",(0,n.jsx)(t.code,{children:"exec"})," command into the application that is deployed. A second command creates a ",(0,n.jsx)(t.code,{children:"tar"})," archive, which is then copied to the host system. This file can then be transferred to a backup server using ",(0,n.jsx)(t.code,{children:"ssh"}),".\nThese commands can be added to a file 'backup.sh'."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"#!/bin/bash\nkubectl exec -it mongo-0 -- mongodump --db idata --out /tmp\nkubectl exec -it mongo-0 -- tar -cvf /tmp/idata.tar /tmp/idata\nkubectl cp mongo-0:/tmp/idata.tar /tmp/idata.tar'\nscp -P 4422 /tmp/idata.tar [USER]@[IP]:[DIRECTORY]\n"})}),"\n",(0,n.jsx)(t.p,{children:"Save the file in a local directory and make sure it has execute rights. Then add the following command to the cron scheduler. In this case a backup is created every hour at 33 minutes past the hour."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"chmod 777 backup.sh\ncrontab -e\n33 * * * * /home/devops/bin/backup.sh > /home/devops/bin/backup.log\n"})}),"\n",(0,n.jsx)(t.h2,{id:"restore-database",children:"Restore database"}),"\n",(0,n.jsx)(t.p,{children:"To restore the database you copy the tar file to the deployed mongo instance on kubernetes and unpack and restore from the host system."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"kubectl cp /tmp/idata.tar mongo-0:/tmp\nkubectl exec -it mongo-0 -- tar -xvf /tmp/idata.tar /tmp/idata\nkubectl exec -it mongo-0 -- mongorestore --db idata /tmp/idata\n"})})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},28453(e,t,a){a.d(t,{R:()=>r,x:()=>c});var o=a(96540);const n={},s=o.createContext(n);function r(e){const t=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);